{% extends "wrapper.html" %}
{% block content %}

<div class="container">

    <center>
        <div class="content" style="height: 55vh;"></div>
    </center>

</div>

<div class="parameters w-100">

    <div class="row" style="height: 45vh;">
        <div class="col-2 p-0 m-0 border border-dark ps-3">
            <center>
                <h2>Control</h2>
            </center>
            <div class="ps-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox"
                        id="flexSwitchCheckDefault">
                    <label class="form-check-label"
                        for="flexSwitchCheckDefault">Debug</label>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox"
                        id="flexSwitchCheckDefault">
                    <label class="form-check-label"
                        for="flexSwitchCheckDefault">Safe mode</label>
                </div>
            </div>
            <hr>

        </div>
        <div class="col-10 border border-dark p-0 m-0">
            <center>
                <h2 class="text-white bg-dark w-100">Parameters</h2>
                <div class="row p-3">
                    <div class="col-2">
                        {% include 'parameters/heater.html' %}
                    </div>
                </div>
            </center>
        </div>
    </div>

</div>

<script>
    $(document).ready(function () {
        const toggleButtons = $('.btn-check');

        // Добавление классов bg-success и bg-secondary при переключении кнопок
        toggleButtons.on('change', function () {
            const button = $(this);
            const isActive = button.prop('checked');
            const label = $(`label[for="${button.attr('id')}"]`);

            if (isActive) {
                label.addClass('bg-success').removeClass('bg-secondary');
            } else {
                label.addClass('bg-secondary').removeClass('bg-success');
            }

            // Обновление модели на сервере
            $.ajax({
                url: '/update_toggle_state/',
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken') // Для Django
                },
                contentType: 'application/json',
                data: JSON.stringify({
                    toggle_id: button.attr('id'),
                    state: isActive
                }),
                success: function () {
                    console.log('Состояние переключателя успешно обновлено');
                },
                error: function (xhr, status, error) {
                    console.error('Ошибка при обновлении состояния переключателя:', error);
                }
            });
        });

        // Функция для получения CSRF токена (Django)
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = $.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>

{% endblock %}