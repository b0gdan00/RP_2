<div class="card border-dark mb-3" style="max-width: 18rem;" id="heater_card">
    <div class="card-header">üî• Heating element</div>
    <div class="card-body text-dark">

        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è -->
        <div class="btn-group" role="group" aria-label="Heater toggle buttons">
            <input type="radio" class="btn-check" name="btnradio_heater"
                id="btn_heater_on"
                autocomplete="off" {% if heater.status %}checked{% endif %}>
            <label for="btn_heater_on"
                class="btn {% if heater.status %}btn-success{% else %}btn-secondary{% endif %}">
                on
            </label>

            <input type="radio" class="btn-check" name="btnradio_heater"
                id="btn_heater_off"
                autocomplete="off" {% if not heater.status %}checked{% endif %}>
            <label for="btn_heater_off"
                class="btn {% if heater.status %}btn-secondary{% else %}btn-danger{% endif %}">
                off
            </label>
        </div>
        <br>
        <!-- –ü–æ–≤–∑—É–Ω–æ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ -->
        <label for="heating" class="form-label mt-3" id="heating_label">
            {{ heater.normal_value }}
        </label><span> ¬∞C</span>
        <input type="range"
            class="form-range"
            id="heating"
            min="{{ heater.min_value }}"
            max="{{ heater.max_value }}"
            value="{{ heater.normal_value }}">
    </div>

    <!-- –°—Ü–µ–Ω–∞—Ä—ñ–π –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
    <script>
        $(document).ready(function () {
            function sendHeaterUpdate() {
                const heaterStatus = $('#btn_heater_on').is(':checked');
                const heaterValue = $('#heating').val();

                $.ajax({
                    url: '/update_heater/', // –ï–Ω–¥–ø–æ—ñ–Ω—Ç
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        status: heaterStatus,
                        value: parseInt(heaterValue)
                    }),
                    success: function (response) {
                        console.log('Heater updated:', response);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error updating heater:', error);
                    }
                });
            }

            // –ü–µ—Ä–µ–º–∏–∫–∞—á on/off
            $('.btn-check').on('change', function () {
                const isChecked = $('#btn_heater_on').is(':checked');

                if (isChecked) {
                    $('#btn_heater_on').next('label').addClass('btn-success').removeClass('btn-secondary');
                    $('#btn_heater_off').next('label').addClass('btn-secondary').removeClass('btn-danger');
                } else {
                    $('#btn_heater_on').next('label').addClass('btn-secondary').removeClass('btn-success');
                    $('#btn_heater_off').next('label').addClass('btn-danger').removeClass('btn-secondary');
                }

                sendHeaterUpdate();
            });

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
            $('#heating').on('input', function () {
                const newVal = $(this).val();
                $('#heating_label').text(newVal);
            });

            // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ª–∏—à–µ –ø—Ä–∏ –≤—ñ–¥–ø—É—Å–∫–∞–Ω–Ω—ñ –º–∏—à—ñ –∞–±–æ –ø–∞–ª—å—Ü—è
            $('#heating').on('mouseup touchend', function () {
                sendHeaterUpdate();
            });
        });
    </script>
</div>
