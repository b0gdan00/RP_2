<div class="card border-dark shadow-lg" style="max-width: 18rem;" id="co2_card">
    <div class="card-header">üí® CO‚ÇÇ System</div>
    <div class="card-body text-dark">

        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è CO2 -->
        <div class="btn-group" role="group" aria-label="CO2 toggle buttons">
            <input type="radio" class="btn-check" name="btnradio_co2" id="btn_co2_on"
                autocomplete="off" {% if co2.status %}checked{% endif %}>
            <label for="btn_co2_on"
                class="btn {% if co2.status %}btn-success{% else %}btn-secondary{% endif %}">
                on
            </label>

            <input type="radio" class="btn-check" name="btnradio_co2" id="btn_co2_off"
                autocomplete="off" {% if not co2.status %}checked{% endif %}>
            <label for="btn_co2_off"
                class="btn {% if co2.status %}btn-secondary{% else %}btn-danger{% endif %}">
                off
            </label>
        </div>
        <br>

        <!-- –ü–æ–≤–∑—É–Ω–æ–∫ –ø–æ–¥–∞—á—ñ CO2 -->
        <label for="co2_slider" class="form-label mt-3" id="co2_label">
            {{ co2.normal_value }}
        </label><span> ppm</span>
        <input type="range"
            class="form-range"
            id="co2_slider"
            min="{{ co2.min_value }}"
            max="{{ co2.max_value }}"
            value="{{ co2.normal_value }}">
    </div>

    <!-- –°—Ü–µ–Ω–∞—Ä—ñ–π –∫–µ—Ä—É–≤–∞–Ω–Ω—è CO2 -->
    <script>
        $(document).ready(function () {
            function sendCO2Update() {
                const co2Status = $('#btn_co2_on').is(':checked');
                const co2Value = $('#co2_slider').val();

                $.ajax({
                    url: '/update_co2/', // –¢–≤—ñ–π endpoint
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        status: co2Status,
                        value: parseInt(co2Value)
                    }),
                    success: function (response) {
                        console.log('CO2 updated:', response);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error updating CO2:', error);
                    }
                });
            }

            // –ü–µ—Ä–µ–º–∏–∫–∞—á ON/OFF
            $('#btn_co2_on, #btn_co2_off').on('change', function () {
                const isChecked = $('#btn_co2_on').is(':checked');

                if (isChecked) {
                    $('#btn_co2_on').next('label').addClass('btn-success').removeClass('btn-secondary');
                    $('#btn_co2_off').next('label').addClass('btn-secondary').removeClass('btn-danger');
                } else {
                    $('#btn_co2_on').next('label').addClass('btn-secondary').removeClass('btn-success');
                    $('#btn_co2_off').next('label').addClass('btn-danger').removeClass('btn-secondary');
                }

                sendCO2Update();
            });

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–µ–π–±–ª—É –ø—ñ–¥ —á–∞—Å —Ä—É—Ö—É –ø–æ–≤–∑—É–Ω–∫–∞
            $('#co2_slider').on('input', function () {
                const newVal = $(this).val();
                $('#co2_label').text(newVal);
            });

            // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –ø—Ä–∏ –≤—ñ–¥–ø—É—Å–∫–∞–Ω–Ω—ñ –ø–æ–≤–∑—É–Ω–∫–∞
            $('#co2_slider').on('mouseup touchend', function () {
                sendCO2Update();
            });
        });
    </script>
</div>
